<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Pulsa Music Conect</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* CSS Extra para garantir que os √≠cones fiquem escondidos */
        input::-webkit-calendar-picker-indicator,
        input::-webkit-inner-spin-button,
        input::-webkit-clear-button {
            display: none !important;
            -webkit-appearance: none !important;
        }
    </style>
</head>
<body>
    <div id="toast-container" class="toast-container"></div>
    {% set foto_url = musico.foto if musico.foto else 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=1000' %}

    <div id="cursor-aura"></div>
    <div class="bg-scene">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

        <nav class="glass-nav">
            <a href="/" style="text-decoration: none;">
                <div class="logo">PULSA<span>MUSIC</span>CONECT</div>
            </a>
            <div class="menu-toggle" id="mobile-menu">
                <span class="bar"></span><span class="bar"></span><span class="bar"></span>
            </div>
            <ul class="nav-links" id="nav-links">
                <li><a href="/" class="btn-nav-link">HOME</a></li>
                {% if session.get('user_email') %}
                    <li><a href="/dashboard" class="btn-user-status">PAINEL</a></li>
                    <li><a href="javascript:void(0)" onclick="abrirModalSenha()" class="btn-user-status">ALTERAR SENHA</a></li>
                    <li><a href="/logout" class="btn-logout">SAIR</a></li>
                {% endif %}
            </ul>
        </nav>

        <div id="modal-senha" class="modal-overlay">
            <div class="modal-content glass-card">
                <button class="close-modal" onclick="fecharModalSenha()">√ó</button>
                <h3>Trocar Senha</h3>
                <p style="font-size: 0.8rem; opacity: 0.7; margin-bottom: 20px;">Digite sua nova senha abaixo.</p>
                
                <form id="form-trocar-senha" class="nebula-form">
                    <div class="input-modern">
                        <input type="password" id="nova-senha" required placeholder=" ">
                        <label>NOVA SENHA</label>
                    </div>
                    <div class="input-modern" style="margin-top: 15px;">
                        <input type="password" id="confirma-senha" required placeholder=" ">
                        <label>CONFIRMAR SENHA</label>
                    </div>
                    
                    <button type="submit" class="btn-glow-action" style="margin-top: 25px; width: 100%;">
                        <span>ATUALIZAR SENHA</span>
                    </button>
                </form>
            </div>
        </div>

    <main class="dash-main">
    <header class="dash-intro">
        <h1 class="reveal-text">PAINEL</h1>
        <p>Gerencie seus pedidos e sua presen√ßa digital.</p>
    </header>

    <div class="mobile-tabs">
        <button class="tab-btn active" onclick="showMobileTab(event, 'perfil')">
            <i class="icon-user"></i>
            <span>Perfil</span>
        </button>
        <button class="tab-btn" onclick="showMobileTab(event, 'agenda')">
            <i class="icon-calendar"></i>
            <span>Agenda</span>
        </button>
        <button class="tab-btn" onclick="showMobileTab(event, 'mensagens')">
            <i class="icon-mail"></i>
            <span>Inbox</span>
        </button>
        <button class="tab-btn" onclick="showMobileTab(event, 'fas')">
            <div style="position: relative; display: inline-block;">
                <i class="icon-star"></i>
                {% if notificacoes_fas > 0 %}
                    <span class="notification-badge">{{ notificacoes_fas }}</span>
                {% endif %}
            </div>
            <span>F√£s</span>
        </button>
    </div>

    <section class="config-grid" style="display: grid; grid-template-columns: 350px 1fr; gap: 30px; align-items: start;">
        
        <aside class="preview-panel" id="preview-col">
            <div class="preview-sticky" style="position: sticky; top: 20px;">
                <span class="label-mini">PR√âVIA DO PERFIL</span>
                <div class="modern-card preview-card">
                    <div class="card-image" id="preview-img" style="background-image: url('{{ foto_url }}');"></div>
                    <div class="card-overlay">
                        <span class="tag" id="preview-tag">{{ musico.estilo or 'Estilo' }}</span>
                        <h3 id="preview-name">{{ musico.nome or 'Nome do Artista' }}</h3>
                        <p style="font-size: 0.7rem; color: rgba(255,255,255,0.8); margin-top: 5px; font-weight: 500;">
                            üìç <span id="preview-cidade">{{ musico.cidade or 'Cidade' }}</span> - <span id="preview-estado">{{ musico.estado or 'UF' }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </aside>

        <div class="main-content-column" style="display: flex; flex-direction: column; gap: 30px;">
        <div class="stats-container" id="aba-stats">
            <div class="stat-card">
                <div class="stat-icon"><i class="icon-trending"></i></div>
                <div class="stat-info">
                    <span class="stat-value">{{ total_cliques or '0' }}</span>
                    <span class="stat-label">Visitas no M√™s</span>
                </div>
                <div class="stat-chart-mini">
                    <svg viewBox="0 0 100 30" class="mini-wave">
                        <path d="M0 20 Q 25 5, 50 20 T 100 20" fill="none" stroke="#00f2ff" stroke-width="2"/>
                    </svg>
                </div>
            </div>
        </div>
        
            <section id="aba-fas" class="glass-card fan-section-container" style="display: none;">
                <div class="section-header" style="margin-bottom: 20px;">
                    <h2 class="section-label">‚≠ê MURAL DE DEPOIMENTOS</h2>
                    <p style="font-size: 0.7rem; opacity: 0.6;">Gerencie o que os f√£s dizem sobre voc√™.</p>
                </div>

                <div class="fan-list">
                    {% for feedback in feedbacks %}
                    <div class="fan-row {% if feedback.status == 'pendente' %}status-pendente{% endif %}">
                        <div class="fan-main-info">
                            <div class="fan-meta">
                                <span class="fan-name">{{ feedback.nome_fa }}</span>
                                <span class="fan-stars">
                                    {% for i in range(feedback.estrelas|int) %}‚òÖ{% endfor %}
                                </span>
                                <span class="status-badge">{{ feedback.status }}</span>
                            </div>
                            <p class="fan-text">"{{ feedback.comentario }}"</p>
                            <span class="fan-date">{{ feedback.data_postagem }}</span>
                        </div>
                        
                        <div class="fan-actions" style="display: flex; gap: 10px; align-items: center;">
                            {% if feedback.status == 'pendente' %}
                            <form action="/aprovar_feedback/{{ feedback.id }}" method="POST">
                                <button type="submit" class="btn-approve-minimal" title="Aprovar depoimento">
                                    ‚úî
                                </button>
                            </form>
                            {% endif %}

                            <form action="/remover_feedback/{{ feedback.id }}" method="POST">
                                <button type="submit" class="btn-delete-minimal" onclick="return confirm('Remover coment√°rio permanentemente?')" title="Excluir">
                                    ‚úï
                                </button>
                            </form>
                        </div>
                    </div>
                    {% else %}
                    <div class="empty-state">Nenhum depoimento encontrado.</div>
                    {% endfor %}
                </div>
            </section>
            
            <section id="aba-inbox" class="inbox-section glass-card" style="padding: 20px; border-radius: 20px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                    <div>
                        <h2 class="section-label">üì© CAIXA DE ENTRADA</h2>
                        <span class="count-badge">{{ pedidos|length }} Mensagens</span>
                    </div>
                    
                    <div id="bulk-actions" style="display: none;">
                        <button onclick="excluirSelecionados()" class="btn-delete-small" style="background: #ff4444; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 0.7rem; font-weight: bold;">
                            üóëÔ∏è EXCLUIR SELECIONADOS (<span id="selected-count">0</span>)
                        </button>
                    </div>
                </div>

                <div class="messages-list">
                    {% if pedidos|length > 0 %}
                    <div style="padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="select-all-messages" onclick="toggleSelectAll(this)" style="cursor: pointer;">
                        <label for="select-all-messages" style="font-size: 0.7rem; opacity: 0.6; cursor: pointer;">SELECIONAR TUDO</label>
                    </div>
                    {% endif %}

                    {% for pedido in pedidos %}
                    <div class="message-item {% if not pedido.lido %}unread{% endif %}" style="display: flex; align-items: center; gap: 12px;">
                        <input type="checkbox" class="msg-checkbox" value="{{ pedido.id }}" onclick="event.stopPropagation(); updateBulkUI()" style="cursor: pointer;">
                        
                        <div style="flex: 1; cursor: pointer; display: flex; align-items: center; gap: 10px;" 
                            onclick="abrirMensagem('{{ pedido.id }}', '{{ pedido.nome_contratante }}', '{{ pedido.email_contratante }}', '{{ pedido.telefone_contratante }}', '{{ pedido.data_evento }}', '{{ pedido.local_evento }}', '{{ pedido.tipo_evento }}')">
                            <div class="msg-status"></div>
                            <div class="msg-info">
                                <span class="msg-sender">{{ pedido.cliente_email }}</span> 
                                <span class="msg-preview">Evento: {{ pedido.tipo_evento }}</span>
                            </div>
                            <span class="msg-date" style="margin-left: auto;">{{ pedido.data_evento }}</span>
                        </div>

                        <button onclick="event.stopPropagation(); excluirMensagemIndividual('{{ pedido.id }}')" 
                                style="background: none; border: none; color: #ff4444; cursor: pointer; padding: 5px; opacity: 0.6; transition: 0.3s;" 
                                title="Excluir">
                            ‚úï
                        </button>
                    </div>
                    {% else %}
                    <div class="empty-inbox">Nenhuma solicita√ß√£o recebida ainda.</div>
                    {% endfor %}
                </div>
            </section>

            <div id="aba-perfil" class="form-panel glass-card" style="padding: 20px; border-radius: 20px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);">
                <form action="{{ url_for('cadastrar_musico') }}" method="POST" enctype="multipart/form-data" class="nebula-form" autocomplete="off">
                    <div class="form-section">
                        <h2 class="section-label">DADOS DO PERFIL</h2>
                        
                        <div class="input-modern">
                            <input type="text" name="nome" id="input-name" required placeholder=" " value="{{ musico.nome or '' }}" data-lpignore="true">
                            <label>NOME DA BANDA / ARTISTA</label>
                        </div>

                        <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 15px;">
                            <div class="input-modern">
                                <input type="text" name="cidade" id="input-cidade" required placeholder=" " value="{{ musico.cidade or '' }}" data-lpignore="true">
                                <label>CIDADE</label>
                            </div>
                            <div class="input-modern">
                                <input type="text" name="estado" id="input-estado" required placeholder=" " maxlength="2" value="{{ musico.estado or '' }}" style="text-transform: uppercase;" data-lpignore="true">
                                <label>UF</label>
                            </div>
                        </div>

                        <div class="input-modern">
                            <select name="estilo" id="select-style">
                                {% for estilo in estilos %}
                                    <option value="{{ estilo }}" {% if musico.estilo == estilo %}selected{% endif %}>
                                        {{ estilo }}
                                    </option>
                                {% endfor %}
                            </select>
                            <label class="label-fixed">G√äNERO MUSICAL</label>
                        </div>
                        <br>

                        <div class="image-config-box" style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 25px;">
                            <div style="text-align: center; margin: 10px 0; font-size: 0.7rem; color: #ffffff; letter-spacing: 2px;">FA√áA UPLOAD PARA IMAGEM DA CAPA</div>
                            <div class="input-modern">
                                <input type="file" name="foto_arquivo" id="input-file" accept="image/*" style="padding-top: 10px;">
                                <label class="label-fixed">ARQUIVO LOCAL (PASTA IMG)</label>
                            </div>
                        </div>

                        <div class="input-modern">
                            <textarea name="bio" rows="4" placeholder=" " data-lpignore="true">{{ musico.bio or '' }}</textarea>
                            <label>SUA HIST√ìRIA (BIO)</label>
                        </div>

                        <h2 class="section-label" style="margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 20px;">PRESEN√áA DIGITAL</h2>
                        
                        <div class="input-modern">
                            <input type="text" name="instagram" id="input-instagram" placeholder="Ex: @seuusuario" value="{{ musico.instagram or '' }}" data-lpignore="true">
                            <label>INSTAGRAM</label>
                        </div>

                        <div class="input-modern">
                            <input type="url" name="facebook" id="input-facebook" placeholder="https://facebook.com/..." value="{{ musico.facebook or '' }}" data-lpignore="true">
                            <label>FACEBOOK (URL)</label>
                        </div>

                        <div class="input-modern">
                            <input type="url" name="youtube" id="input-youtube" placeholder="https://youtube.com/..." value="{{ musico.youtube or '' }}" data-lpignore="true">
                            <label>YOUTUBE (CANAL OU V√çDEO)</label>
                        </div>
                    </div>

                    <button type="submit" class="btn-glow-action" style="margin-top: 20px; width: 100%;">
                        <span>SALVAR ALTERA√á√ïES</span>
                    </button>
                </form>
            </div>

            <section id="aba-agenda" class="agenda-manager-section glass-card" style="padding: 20px; border-radius: 20px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);">
                <div class="section-header" style="margin-bottom: 20px;">
                    <h2 class="section-label">üìÖ GEST√ÉO DE AGENDA</h2>
                </div>
                
                <div class="glass-card" style="padding: 20px; margin-bottom: 20px; background: rgba(255,255,255,0.02);">
                    <form action="/adicionar_agenda" method="POST" autocomplete="off" aria-autocomplete="none" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; align-items: end;">
                        <input type="text" name="fake_user" style="display:none" aria-hidden="true">
                        <input type="password" name="fake_pass" style="display:none" aria-hidden="true">

                        <div class="input-modern">
                            <input type="date" name="data_show" required data-lpignore="true" data-1p-ignore>
                            <label class="label-fixed">DATA</label>
                        </div>
                        <div class="input-modern">
                            <input type="time" name="horario_show" required data-lpignore="true" data-1p-ignore> 
                            <label class="label-fixed">HOR√ÅRIO</label>
                        </div>
                        <div class="input-modern">
                            <input type="text" name="nome_festa" placeholder="Ex: Festival..." autocomplete="new-password" data-lpignore="true"> 
                            <label class="label-fixed">NOME DA FESTA</label>
                        </div>
                        <div class="input-modern">
                            <input type="text" name="local" placeholder="Ex: Pra√ßa..." required autocomplete="new-password" data-lpignore="true">
                            <label class="label-fixed">LOCAL</label>
                        </div>
                        <div class="input-modern">
                            <input type="text" name="cidade" placeholder="Ex: S√£o Luiz..." required autocomplete="new-password" data-lpignore="true">
                            <label class="label-fixed">CIDADE</label>
                        </div>
                        <button type="submit" class="btn-show-add" style="height: 45px;">
                            <span>+ ADD SHOW</span>
                        </button>
                    </form>
                </div>

                <div class="messages-list">
                    {% for show in agenda %}
                    <div class="message-item">
                        <div class="msg-info">
                            <span class="msg-sender">{{ show.data_dia }}/{{ show.data_mes }} - {{ show.local }}</span>
                            <span class="msg-preview">{{ show.cidade }}</span>
                        </div>
                        <form action="/remover_agenda/{{ show.id }}" method="POST">
                            <button type="submit" style="background: none; border: none; color: #ff4444; cursor: pointer; font-size: 0.8rem;">[EXCLUIR]</button>
                        </form>
                    </div>
                    {% else %}
                    <div class="empty-inbox">Nenhum show na agenda ainda.</div>
                    {% endfor %}
                </div>
            </section>

        </div>
    </section>
</main>
    <div id="modal-leitura" class="modal-overlay">
        <div class="modal-content glass-card">
            <button class="close-modal" onclick="fecharModal()">√ó</button>
            <h3>Detalhes da Solicita√ß√£o</h3>
            <hr class="modal-divider">
            <div class="modal-body">
                <p><strong>Solicitante:</strong> <span id="view-nome"></span></p>
                <p><strong>E-mail:</strong> <span id="view-email"></span></p>
                <p>
                    <strong>WhatsApp:</strong> 
                    <a href="#" id="link-telefone-zap" target="_blank" style="color: #25d366; text-decoration: none; font-weight: bold;">
                        <span id="view-telefone"></span>
                    </a>
                </p>
                <hr class="modal-divider-vagas">
                <p><strong>Data do Evento:</strong> <span id="view-data"></span></p>
                <p><strong>Local:</strong> <span id="view-local"></span></p>
                <p><strong>Tipo de Evento:</strong> <span id="view-tipo"></span></p>
                
                <div class="alert-info">Combine os detalhes e o cach√™ diretamente com o cliente.</div>
            </div>

            <a href="" id="btn-whats-action" target="_blank" class="btn-glow-action" style="text-decoration: none; text-align: center; display: block; background: #25d366; margin-bottom: 10px;">
                <span>RESPONDER PELO WHATSAPP</span>
            </a>

            <a href="" id="btn-responder" class="btn-glow-action" style="text-decoration: none; text-align: center; display: block; opacity: 0.8;">
                <span>RESPONDER POR E-MAIL</span>
            </a>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>