<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Pulsa Music Conect</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <meta property="og:title" content="{{ musico.nome }} | Pulsa Music Conect">
    <meta property="og:description" content="A m√∫sica que pulsa no cora√ß√£o da gente. üé∂ Clique para conhecer o perfil oficial de {{ musico.nome }}, ver a agenda de shows e fazer parte da nossa comunidade!">
    
    <meta property="og:image" content="{{ foto_meta }}">
    <meta property="og:image:secure_url" content="{{ foto_meta }}">
    <meta property="og:image:type" content="image/png">
    
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="profile">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="{{ foto_meta }}">
</head>

<body>
    {% if exibir_boas_vindas_interno %}
    <div id="modal-boas-vindas-sistema" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
        <div style="background: #1a1a1a; padding: 40px; border-radius: 10px; border: 1px solid #00ffcc; text-align: center; max-width: 400px;">
            <h2 style="color: #00ffcc; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; ">BEM-VINDO! üöÄ</h2>
            <p style="color: white; margin: 20px 0;">Sua assinatura foi confirmada. Seu painel de m√∫sico j√° est√° liberado!</p>
            <button onclick="fecharBoasVindas()" style="background: #00ffcc; color: black; border: none; padding: 12px 30px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%;">
                COME√áAR AGORA
            </button>
        </div>
    </div>

    <script>
        function fecharBoasVindas() {
            document.getElementById('modal-boas-vindas-sistema').style.display = 'none';
            // Limpa a URL para o link ficar limpo
            const novaUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
            window.history.pushState({path: novaUrl}, '', novaUrl);
        }
    </script>
    {% endif %}


{% if bloqueado %}
<div style="
    position: fixed; /* Troque para fixed para garantir que ele ignore outras divs */
    top: 90px;
    
    /* AQUI EST√Å A SOLU√á√ÉO: */
    left: 50%; /* Ele nasce no meio da tela */
    transform: translateX(95px); /* Ele anda 180px para a DIREITA do meio */
    /* Ajuste o 180px para mais ou menos at√© ele 'colar' onde voc√™ quer */
    
    z-index: 10000;
    display: flex;
    align-items: center;
    gap: 15px;
    background: rgba(15, 0, 0, 0.98);
    padding: 8px 18px;
    border-radius: 6px;
    backdrop-filter: blur(15px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.8);
    border: 1px solid rgba(255,0,0,0.3);
    border-left: 4px solid #ff0000;
    white-space: nowrap;
">
    <div style="display: flex; align-items: center; flex-shrink: 0;">
        <i class="fas fa-exclamation-circle" style="color: #ff4d4d; margin-right: 8px; font-size: 1rem;"></i>
        <p style="color: white; font-size: 0.8rem; margin: 0; font-family: 'Inter', sans-serif;">
            Sua assinatura <strong>Pulsa Music</strong> expirou. Seu perfil est√° invis√≠vel para contratantes.
        </p>
    </div>

    <a href="/checkout" style="
        background: #00b818; 
        color: white; 
        padding: 5px 15px; 
        border-radius: 4px; 
        text-decoration: none; 
        font-weight: bold; 
        font-size: 0.65rem; 
        text-transform: uppercase;
    ">
        Reativar
    </a>
</div>
{% endif %}

    <div id="toast-container" class="toast-container"></div>
    {% set foto_url = musico.foto if musico.foto else 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=1000' %}
    <div id="cursor-aura"></div>
    <div class="bg-scene">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

<nav class="glass-nav">
    <a href="/" style="text-decoration: none;">
        <img src="static/img/conect1.png" alt="PULSAMUSICCONECT" class="logo-img">
    </a>
    <div class="menu-toggle" id="mobile-menu">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </div>
    
    <ul class="nav-links" id="nav-links">
        {% if session.get('user_email') %}
            <li class="mobile-only-item profile-card-mobile">
                <div class="user-avatar-1to1" style="background-image: url('{{ foto_url }}');"></div>
                <span class="user-name-text">{{ musico.nome or 'Nome do Artista' }}</span>
                <span class="tag">{{ musico.estilo or 'Estilo' }}</span>
            </li>
        {% endif %}
        <li>
            <a href="javascript:void(0)" 
               onclick="compartilharPerfil(this)" 
               onfocus="this.blur()"
               data-nome-url="{{ musico.nome | replace(' ', '-') | lower }}" 
               data-nome-exibicao="{{ musico.nome }}"
               class="btn-nav-link" 
               style="color: #00fd15; border: none; background: none; cursor: pointer; outline: none; box-shadow: none;">
                <i class="fas fa-share-alt"></i> <span>COMPARTILHAR PERFIL</span>
            </a>
        </li>

        <li><a href="/" class="btn-nav-link" onfocus="this.blur()" style="outline: none; box-shadow: none;"><i class="fas fa-home"></i> <span>HOME</span></a></li>
        
        {% if session.get('user_email') %}
    <li class="desktop-only-menu">
        <a href="javascript:void(0)" onclick="showSection('aba-perfil')" onfocus="this.blur()" class="btn-nav-link" style="outline: none; box-shadow: none;">
            <i class="fas fa-user"></i> <span>PERFIL</span>
        </a>
    </li>
    
    <li class="desktop-only-menu">
        <a href="javascript:void(0)" onclick="showSection('aba-agenda')" onfocus="this.blur()" class="btn-nav-link" style="outline: none; box-shadow: none;">
            <i class="fas fa-calendar-alt"></i> <span>AGENDA</span>
        </a>
    </li>

    <li class="desktop-only-menu">
        <a href="javascript:void(0)" onclick="showSection('aba-inbox')" onfocus="this.blur()" class="btn-nav-link" style="outline: none; box-shadow: none; position: relative;">
            <i class="fas fa-envelope"></i> <span>INBOX</span>
            {% if notificacoes_mensagens and notificacoes_mensagens > 0 %}
                <span class="badge-notificacao">{{ notificacoes_mensagens }}</span>
            {% endif %}
        </a>
    </li>

    <li class="desktop-only-menu">
        <a href="javascript:void(0)" onclick="showSection('aba-fas')" onfocus="this.blur()" class="btn-nav-link" style="outline: none; box-shadow: none; position: relative;">
            <i class="fas fa-users"></i> <span>COMUNIDADE</span>
            {% if notificacoes_fas and notificacoes_fas > 0 %}
                <span class="badge-notificacao">{{ notificacoes_fas }}</span>
            {% endif %}
        </a>
    </li>
    
    <li id="container-seguranca" class="desktop-only-menu" style="position: relative;">
        <a href="javascript:void(0)" onclick="toggleSeguranca(event)" onfocus="this.blur()" class="btn-nav-link" style="display: flex; align-items: center; gap: 8px; outline: none; box-shadow: none; margin-top: 5px;">
            <i class="fas fa-shield-alt"></i> 
            <span>SEGURAN√áA E PRIVACIDADE</span>
            <i class="fas fa-chevron-down" id="seta-seguranca" style="font-size: 0.8em; transition: transform 0.3s;"></i>
        </a>
        <ul id="lista-seguranca" style="display: none; list-style: none; position: absolute; top: 100%; left: 0; min-width: 220px; z-index: 999; margin-top: 10px; background-color: #1a1a1a; padding: 10px; border-radius: 8px; box-shadow: 0 8px 16px rgba(0,0,0,0.3);">
            <li style="margin-bottom: 5px;"><a href="javascript:void(0)" onclick="abrirModalSenha()" class="btn-nav-link" style="color: #fff !important;"><i class="fas fa-lock"></i> <span>ALTERAR SENHA</span></a></li>
            <li style="margin-bottom: 5px;"><a href="/termos" class="btn-nav-link" style="color: #fff !important;"><i class="fas fa-file-alt"></i> <span>TERMOS</span></a></li>
            <li><a href="/privacidade" class="btn-nav-link" style="color: #fff !important;"><i class="fas fa-user-shield"></i> <span>PRIVACIDADE</span></a></li>
        </ul>
    </li>

    <li class="mobile-only-item">
        <a href="javascript:void(0)" onclick="abrirModalSenha()" onfocus="this.blur()" class="btn-nav-link" style="outline: none; box-shadow: none;">
            <i class="fas fa-lock"></i> <span>ALTERAR SENHA</span>
        </a>
    </li>
    
    <li>
        <a href="/logout" class="btn-logout" onfocus="this.blur()" style="outline: none; box-shadow: none;">
            <i class="fas fa-sign-out-alt"></i> <span>SAIR</span>
        </a>
    </li>
{% endif %}

        <li class="mobile-only-item"><a href="/termos" class="btn-nav-link" onfocus="this.blur()" style="outline: none; box-shadow: none;"><i class="fas fa-file-alt"></i> <span>TERMOS</span></a></li>
        <li class="mobile-only-item"><a href="/privacidade" class="btn-nav-link" onfocus="this.blur()" style="outline: none; box-shadow: none;"><i class="fas fa-shield-alt"></i> <span>PRIVACIDADE</span></a></li>
    </ul>
</nav>


<div id="modal-senha" class="modal-overlay">
    <div class="modal-content glass-card">
        <button class="close-modal" onclick="fecharModalSenha()">√ó</button>
        <h3>Trocar Senha</h3>
        <form id="form-trocar-senha" class="nebula-form">
            <div class="input-modern">
                <input type="password" id="nova-senha" required placeholder=" ">
                <label>NOVA SENHA</label>
            </div>
            <div class="input-modern" style="margin-top: 15px;">
                <input type="password" id="confirma-senha" required placeholder=" ">
                <label>CONFIRMAR SENHA</label>
            </div>
            <button type="submit" class="btn-glow-action" style="margin-top: 25px; width: 100%;">
                <span>ATUALIZAR SENHA</span>
            </button>
        </form>
    </div>
</div>


<main class="dash-main">
    <header class="dash-intro" style="margin-bottom: 40px;">
        <h1 class="reveal-text" style="font-family: 'Orbitron', sans-serif; letter-spacing: 4px; display: flex; align-items: center; gap: 15px;">
            PAINEL 
            <span style="width: 2px; height: 30px; background: rgba(255,255,255,0.2);"></span> 
            <span id="header-user-name" style="font-size: 1.2rem; color: #00f2ff; text-shadow: 0 0 10px rgba(0,242,255,0.5); font-weight: 300;">
                {% if musico.nome %}{{ musico.nome|upper }}{% else %}LOGADO{% endif %}
            </span>
        </h1>
        <p style="opacity: 0.6; font-size: 0.9rem; margin-top: 5px;">Bem-vindo de volta! Gerencie seus pedidos e sua presen√ßa digital.</p>
        

        <div class="dashboard-right-align desktop-only-menu"> 
            <div class="tool-card-simple">
                <div class="tool-content">
                    <i data-lucide="briefcase" class="icon-tool"></i>
                    <div class="tool-text">
                        <h4>Proposta de Show</h4>
                        <p>Envie or√ßamentos personalizados.</p>
                    </div>
                </div>
                <button onclick="openModal('modalProposta')" class="btn-card-action">CRIAR PROPOSTA</button>
            </div>
            <div class="tool-card-simple" style="position: relative; overflow: visible !important;">
                {% if total_propostas and total_propostas > 0 %}
                    <span class="badge-contador-propostas">{{ total_propostas }}</span>
                {% endif %}

                <div class="tool-content">
                    <i data-lucide="folder-open" class="icon-tool"></i>
                    <div class="tool-text">
                        <h4>Minhas Propostas</h4>
                        <p>Veja or√ßamentos enviados.</p>
                    </div>
                </div>
                <button type="button" onclick="openModal('modalHistoricoPropostas')" class="btn-card-action">VER ENVIADAS</button>
            </div>
        </div>
    </header>

    <div class="network-presence-pill">
        {% if pagou %}
            {% if dias_restantes is not none and dias_restantes <= 7 %}
                <div class="presence-indicator warning"></div>
                <span class="presence-status warning-text">Ciclo de visibilidade termina em breve</span>
                <span class="presence-pipe"></span>
                <span class="presence-info">Pr√≥xima atualiza√ß√£o: <strong>{{ data_vencimento }}</strong></span>
            {% else %}
                <div class="presence-indicator active"></div>
                <span class="presence-status active-text">Perfil Ativo na Rede</span>
                <span class="presence-pipe"></span>
                <span class="presence-info">Renova√ß√£o: <strong>{{ data_vencimento }}</strong></span>
            {% endif %}
        {% else %}
            <div class="presence-indicator offline"></div>
            <span class="presence-status offline-text">Perfil Offline</span>
        {% endif %}
    </div>

    {% if musico.nome %}
        <div class="mobile-tabs">
            <button class="tab-btn active" onclick="showMobileTab(event, 'perfil')">
                <i class="icon-user"></i>
                <span>Perfil</span>
            </button>

            <button class="tab-btn" onclick="showMobileTab(event, 'agenda')">
                <i class="icon-calendar"></i>
                <span>Agenda</span>
            </button>

            <button class="tab-btn" onclick="openModal('modalProposta')">
                <div class="circle-neon-proposta">
                    <i class="icon-plus"></i>
                </div>
                <span>Proposta</span>
            </button>

            <button class="tab-btn" onclick="showMobileTab(event, 'mensagens')">
                <i class="icon-mail"></i>
                <span>Inbox</span>
            </button>

            <button class="tab-btn" onclick="showMobileTab(event, 'fas')">
                <div style="position: relative; display: inline-block;">
                    <i class="icon-star"></i>
                    {% if notificacoes_fas > 0 %}
                        <span class="notification-badge">{{ notificacoes_fas }}</span>
                    {% endif %}
                </div>
                <span>F√£s</span>
            </button>
        </div>
    {% endif %}

<!-- SE√á√ÉO PREVIA DO PERFIL     -->
<section class="config-grid" style="display: grid; grid-template-columns: 350px 1fr; gap: 30px; align-items: start;">
        
        <aside class="preview-panel" id="preview-col">
            <div class="preview-sticky" style="position: sticky; top: 20px;">
                <span class="label-mini">PR√âVIA DO PERFIL</span>
                <div class="modern-card preview-card">
                    <div class="card-image" id="preview-img" style="background-image: url('{{ foto_url }}');"></div>
                    <div class="card-overlay">
                        <span class="tag" id="preview-tag">{{ musico.estilo or 'Estilo' }}</span>
                        <h3 id="preview-name">{{ musico.nome or 'Nome do Artista' }}</h3>
                        <p style="font-size: 0.7rem; color: rgba(255,255,255,0.8); margin-top: 5px; font-weight: 500;">
                            üìç <span id="preview-cidade">{{ musico.cidade or 'Cidade' }}</span> - <span id="preview-estado">{{ musico.estado or 'UF' }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </aside>
        

        <!-- VISTAS DO M√™S -->
       <div class="main-content-column" style="display: flex; flex-direction: column; gap: 30px;">
        <div class="dashboard-top-row">
            <div class="stats-container" id="aba-stats">
                <div class="stat-card">
                    <div class="stat-icon-main"><i class="icon-trending"></i></div>
                    <div class="stat-info">
                        <span class="stat-value-large">{{ total_cliques or '0' }}</span>
                        <span class="stat-label">Visitas - Cliques</span>
                    </div>
                    <div class="stat-chart-mini">
                        <svg viewBox="0 0 100 30" class="mini-wave">
                            <path d="M0 20 Q 25 5, 50 20 T 100 20" fill="none" stroke="#00f2ff" stroke-width="2"/>
                        </svg>
                    </div>
                </div>
            </div>


        <!-- F√ÇS -->
        <div class="stats-bar-modern compact mobile-hide-control">
            <div class="stat-item" onclick="showMobileTab(event, 'fas')" style="cursor: pointer;">
                <div class="stat-icon-small"><i class="fas fa-users"></i></div>
                <div class="stat-content">
                    <span class="stat-value-small">{{ feedbacks|length }}</span>
                    <span class="stat-label-small">F√ÉS</span>
                </div>
            </div>
            
            <div class="stat-divider-small"></div>
            
                <div class="stat-item">
                    <div class="stat-icon-small" style="color: #ffca28;"><i class="fas fa-star"></i></div>
                    <div class="stat-content">
                        <span class="stat-value-small">
                            {{ "%.1f"|format(musico.media_estrelas|default(0.0)|float) }}
                        </span>
                        <span class="stat-label-small">AVALIA√á√ÉO</span>
                    </div>
                </div>
            </div>
        </div> 

<!-- PERFIL DO USUARIO -->
<div id="aba-perfil" class="form-panel glass-card" style="padding: 20px; border-radius: 10px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);">
    <form action="{{ url_for('cadastrar_musico') }}" method="POST" enctype="multipart/form-data" class="nebula-form" autocomplete="off">
        <div class="form-section">
            <h2 class="section-label">DADOS DO PERFIL</h2>

                        <div class="input-modern-wrapper" style="margin-top: 30px; margin-bottom: 30px; color: #4facfe; font-weight: 700; font-size: 0.7rem;">
                <label class="label-static">CATEGORIA DO ARTISTA</label>
                
                <div class="modern-options">
                    <label class="option-item">
                        <input type="radio" name="tipo" value="dj" {% if musico.tipo == 'dj' %}checked{% endif %} required>
                        <span class="option-button">
                            <i class="fas fa-compact-disc"></i> DJ
                        </span>
                    </label>

                    <label class="option-item">
                        <input type="radio" name="tipo" value="m√∫sico" {% if musico.tipo == 'm√∫sico' %}checked{% endif %}>
                        <span class="option-button">
                            <i class="fas fa-user"></i> M√öSICO
                        </span>
                    </label>

                    <label class="option-item">
                        <input type="radio" name="tipo" value="banda" {% if musico.tipo == 'banda' %}checked{% endif %}>
                        <span class="option-button">
                            <i class="fas fa-users"></i> BANDA
                        </span>
                    </label>
                </div>
            </div>
            
            <div class="input-modern" style="border: 1px dashed rgba(0, 242, 255, 0.3); padding: 10px; border-radius: 10px; margin-bottom: 20px;">
                <input type="url" name="vibracao_link" id="input-vibracao" placeholder="https://open.spotify.com/track/..." value="{{ musico.vibracao_link or '' }}" data-lpignore="true">
                <label><i class="fas fa-play-circle"></i> LINK DA M√öSICA (SPOTIFY, SOUNDCLOUD, ETC)</label>
                <small style="color: rgba(255,255,255,0.5); font-size: 0.9rem; margin-top: 5px; display: block;">
                    Cole aqui o link da m√∫sica que aparecer√° no seu "Preview Sonoro".
                </small>
            </div>

            <div class="input-group-row" style="display: flex; gap: 15px; width: 100%;">
                
                <div class="input-modern" style="flex: 1;">
                    <input type="text" name="nome" id="input-name" required placeholder=" " value="{{ musico.nome or '' }}" data-lpignore="true" maxlength="30">
                    <label>NOME DA BANDA / ARTISTA</label>
                </div>

                <div class="input-modern" style="flex: 1;">
                    <input type="text" name="contato" id="input-contact" required 
                        placeholder="(00) 00000-0000" 
                        value="{{ musico.contato or '' }}" 
                        oninput="mascaraTelefone(this)" 
                        maxlength="15">
                    <label>CONTATO</label>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 15px;">
                <div class="input-modern" style="width: 69%";>
                    <input type="text" name="cidade" id="input-cidade" required placeholder=" " value="{{ musico.cidade or '' }}" data-lpignore="true">
                    <label>CIDADE</label>
                </div>
                <div class="input-modern">
                    <input type="text" name="estado" id="input-estado" required placeholder=" " maxlength="2" value="{{ musico.estado or '' }}" style="text-transform: uppercase;" data-lpignore="true">
                    <label>UF</label>
                </div>
            </div>

            <div class="input-modern">
                <select name="estilo" id="select-style">
                    {% for estilo in estilos %}
                        <option value="{{ estilo }}" {% if musico.estilo == estilo %}selected{% endif %}>
                            {{ estilo }}
                        </option>
                    {% endfor %}
                </select>
                <label class="label-fixed">G√äNERO MUSICAL</label>
            </div>
            <br>

            <div class="image-config-box" style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 25px; font-family: 'Orbitron', sans-serif;">
                <div style="text-align: center; margin: 10px 0; font-size: 0.7rem; color: #ffffff; letter-spacing: 2px;">FA√áA UPLOAD PARA IMAGEM DA CAPA</div>
                <div class="input-modern">
                    <input type="file" name="foto_arquivo" id="input-file" accept="image/*" 
                        style="
                            padding-top: 10px;
                            color: #888;
                            font-size: 0.8rem;
                        ">
                    
                    <style>
                        #input-file::file-selector-button {
                            background: rgba(255,255,255,0.1);
                            color: white;
                            border: 1px solid rgba(255,255,255,0.2);
                            padding: 8px 15px;
                            border-radius: 8px;
                            cursor: pointer;
                            margin-right: 15px;
                            transition: 0.3s;
                            font-family: inherit;
                        }

                        #input-file::file-selector-button:hover {
                            background: rgba(255,255,255,0.2);
                            border-color: rgba(255,255,255,0.5);
                        }
                    </style>

                    <label class="label-fixed" style="display: block; margin-top: 5px; font-size: 0.7rem; color: rgba(255,255,255,0.4);">ARQUIVO LOCAL (PASTA IMG)</label>
                </div>
            </div>

            <div class="input-modern">
                <textarea name="bio" rows="4" placeholder=" " data-lpignore="true" style="resize: none;">{{ musico.bio or '' }}</textarea>
                <label>SUA HIST√ìRIA (BIO)</label>
            </div>

            <h2 class="section-label" style="margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 20px;">PRESEN√áA DIGITAL</h2>
            
            <div class="input-modern">
                <input type="text" name="instagram" id="input-instagram" placeholder="Ex: @seuusuario" value="{{ musico.instagram or '' }}" data-lpignore="true">
                <label>INSTAGRAM</label>
            </div>

            <div class="input-modern">
                <input type="url" name="facebook" id="input-facebook" placeholder="https://facebook.com/..." value="{{ musico.facebook or '' }}" data-lpignore="true">
                <label>FACEBOOK (URL)</label>
            </div>

            <div class="input-modern">
                <input type="url" name="youtube" id="input-youtube" placeholder="https://youtube.com/..." value="{{ musico.youtube or '' }}" data-lpignore="true">
                <label>YOUTUBE (CANAL OU V√çDEO)</label>
            </div>
        </div>

        <button type="submit" class="btn-glow-action">
            <span>SALVAR ALTERA√á√ïES</span>
        </button>
    </form>
</div>        

<!-- CAIXA DE ENTRADA - INBOX -->
<section id="aba-agenda" class="agenda-manager-section section-hidden">
    <div class="agenda-header">
        <h2 class="section-label">üìÖ GEST√ÉO DE AGENDA</h2>
    </div>
    
    <div class="agenda-form-container glass-card">
        <form action="/adicionar_agenda" method="POST" autocomplete="off" class="agenda-grid-form">
            <div class="input-group-row">
                <div class="input-modern-agenda">
                    <label class="label-fixed">DATA</label>
                    <input type="date" name="data_show" required>
                </div>
                <div class="input-modern-agenda">
                    <label class="label-fixed">HOR√ÅRIO</label>
                    <input type="time" name="horario_show" required> 
                </div>
            </div>

            <div class="input-modern-agenda">
                <label class="label-fixed">NOME DA FESTA</label>
                <input type="text" name="nome_festa" placeholder="Ex: Festival..." maxlength="25"> 
            </div>

            <div class="input-modern-agenda">
                <label class="label-fixed">LOCAL</label>
                <input type="text" name="local" placeholder="Ex: Pra√ßa..." required maxlength="25">
            </div>

            <div class="input-modern-agenda">
                <label class="label-fixed">CIDADE</label>
                <input type="text" name="cidade" placeholder="Ex: S√£o Luiz..." required maxlength="25">
            </div>

            <button type="submit" class="btn-agenda-add">
                <span>+ ADD SHOW</span>
            </button>
        </form>
    </div>
    
    <div class="agenda-header">
        <h2 class="agenda-title">Agenda de Shows</h2>
        <div class="agenda-subtitle">Clique no X para excluir</div>
    </div>

    <div class="agenda-items-list">
    {% for show in agenda %}
    <div class="agenda-item-card">
        <div class="card-side-date">
            <span class="date-number">{{ show.data_dia }}</span>
            <span class="date-month">FEV</span>
        </div>

        <div class="card-main-content">
            <div class="show-title">{{ show.nome_festa }}</div>
            
            <div class="show-details">
                <span>üìç {{ show.local }}</span>
                <span>üèôÔ∏è {{ show.cidade }} ‚Ä¢ {{ show.horario }}</span>
            </div>
        </div>

        <form action="/remover_agenda/{{ show.id }}" method="POST">
            <button type="submit" class="btn-delete-minimal">‚úï</button>
        </form>
    </div>
    {% endfor %}
</div>
</section>


<section id="aba-inbox" class="inbox-container glass-card">
    <div class="inbox-header">
        <div class="header-info">
            <h2 class="header-title">CAIXA DE ENTRADA</h2>
            {% set novas = pedidos | selectattr('lido', 'equalto', false) | list | length %}
            <span class="count-badge">
                {% if novas > 0 %}
                    {{ novas }} NOVAS SOLICITA√á√ïES
                {% else %}
                    NENHUMA SOLICITA√á√ÉO NOVA
                {% endif %}
            </span>
        </div>
        
        <div id="bulk-actions" class="bulk-actions-floating" style="display: none;">
            <button onclick="excluirSelecionados()" class="btn-delete-bulk">
                EXCLUIR SELECIONADOS <span id="selected-count">0</span>
            </button>
        </div>
    </div>

    <div class="messages-list-wrapper">
        {% if pedidos|length > 0 %}
        <div class="select-all-bar">
            <label class="custom-checkbox">
                <input type="checkbox" id="select-all-messages" onclick="toggleSelectAll(this)">
                <span class="checkmark"></span>
                <span class="label-text">MARCAR TODAS AS MENSAGENS</span>
            </label>
        </div>

        <div class="messages-stack">
            {% for pedido in pedidos %}
            <div class="message-card {% if not pedido.lido %}unread{% endif %}">
                <div class="msg-check-area">
                    <label class="custom-checkbox">
                        <input type="checkbox" class="msg-checkbox" value="{{ pedido.id }}" onclick="event.stopPropagation(); updateBulkUI()">
                        <span class="checkmark"></span>
                    </label>
                </div>
                
                <div class="msg-status-dot"></div>

                <div class="msg-main-content" 
                     onclick="abrirMensagem('{{ pedido.id }}', '{{ pedido.nome_contratante }}', '{{ pedido.email_contratante }}', '{{ pedido.telefone_contratante }}', '{{ pedido.data_evento }}', '{{ pedido.local_evento }}', '{{ pedido.tipo_evento }}')">
                    
                    <div class="msg-details">
                        <div class="msg-column">
                            <span class="msg-label">CONTRATANTE</span>
                            <span class="msg-sender">{{ pedido.nome_contratante if pedido.nome_contratante else pedido.cliente_email }}</span>
                        </div>
                        
                        <div class="msg-column">
                            <span class="msg-label">TIPO DE FESTA</span>
                            <span class="msg-event-type">{{ pedido.tipo_evento }}</span>
                        </div>
                    </div>

                    <div class="msg-date-area">
                        <span class="msg-label">DATA</span>
                        <span class="msg-date-tag">{{ pedido.data_evento }}</span>
                    </div>
                </div>

                <div class="msg-actions">
                    <button onclick="abrirMensagem('{{ pedido.id }}', '{{ pedido.nome_contratante }}', '{{ pedido.email_contratante }}', '{{ pedido.telefone_contratante }}', '{{ pedido.data_evento }}', '{{ pedido.local_evento }}', '{{ pedido.tipo_evento }}')" 
                            class="btn-view-more">
                        VER DETALHES
                    </button>
                    
                    <button onclick="event.stopPropagation(); excluirMensagemIndividual('{{ pedido.id }}')" 
                            class="btn-item-delete-text">
                        REMOVER
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>

        {% else %}
        <div class="empty-inbox-state">
            <p class="empty-text">N√ÉO H√Å NOVAS SOLICITA√á√ïES NA SUA FILA</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- MURAL DE F√ÇS -->
<section id="aba-fas" class="fan-section-container">
    <div class="section-header">
        <h2 class="section-label">‚≠ê Mural de Depoimentos</h2>
        <p class="section-subtitle">Gerencie o que os f√£s dizem sobre voc√™.</p>
    </div>

    <div class="fan-list">
        {% for feedback in feedbacks %}
        <div class="fan-row {% if feedback.status == 'pendente' %}status-pendente{% endif %}" {% if feedback.status == 'excluido' %}style="opacity: 0.5;"{% endif %}>
            <div class="fan-main-info">
                <div class="fan-meta">
                    <span class="fan-name">{{ feedback.nome_fa }}</span>
                    <span class="fan-stars">
                        {% for i in range(feedback.estrelas|int) %}‚òÖ{% endfor %}
                    </span>
                    <span class="status-badge">
                        {% if feedback.status == 'pendente' %}
                            <b style="color: #00fd15;">‚óè NOVO</b>
                        {% elif feedback.status == 'excluido' %}
                            OCULTO
                        {% else %}
                            NO MURAL
                        {% endif %}
                    </span>
                </div>
                <p class="fan-text" {% if feedback.status == 'excluido' %}style="text-decoration: line-through;"{% endif %}>
                    "{{ feedback.comentario }}"
                </p>
                <span class="fan-date">{{ feedback.data_postagem }}</span>
            </div>
            
            <div class="fan-actions">
                {# Bot√£o para marcar como lido ou restaurar #}
                {% if feedback.status == 'pendente' or feedback.status == 'excluido' %}
                <form action="/aprovar_feedback/{{ feedback.id }}" method="POST">
                    <button type="submit" class="btn-approve-minimal" title="Confirmar/Restaurar">
                        ‚úî
                    </button>
                </form>
                {% endif %}

                {# Bot√£o para ocultar #}
                {% if feedback.status != 'excluido' %}
                <form action="/remover_feedback/{{ feedback.id }}" method="POST">
                    <button type="submit" class="btn-delete-minimal" onclick="return confirm('Ocultar este coment√°rio do perfil p√∫blico?')" title="Ocultar">
                        ‚úï
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="empty-state">Nenhum depoimento encontrado.</div>
        {% endfor %}
    </div>
</section>
 
</main>

<!-- PROPOSTA RECEBIDA - SOLICITA√á√ÉO CONTRATANTE -->
<div id="modal-leitura" class="modal-overlay">
    <div class="modal-content glass-card">
        <button class="close-modal" onclick="fecharModal()">√ó</button>
        <h3>Detalhes da Solicita√ß√£o</h3>
        <hr class="modal-divider">
        <div class="modal-body">
            <p><strong>Solicitante:</strong> <span id="view-nome"></span></p>
            <p><strong>E-mail:</strong> <span id="view-email"></span></p>
            <p>
                <strong>WhatsApp:</strong> 
                <a href="#" id="link-telefone-zap" target="_blank" style="color: #25d366; text-decoration: none; font-weight: bold;">
                    <span id="view-telefone"></span>
                </a>
            </p>
            <hr class="modal-divider-vagas">
            <p><strong>Data do Evento:</strong> <span id="view-data"></span></p>
            <p><strong>Local:</strong> <span id="view-local"></span></p>
            <p><strong>Tipo de Evento:</strong> <span id="view-tipo"></span></p>
            
            <div class="alert-info">Combine os detalhes e o cach√™ diretamente com o cliente.</div>
        </div>

        <a href="" id="btn-whats-action" target="_blank" class="btn-whats-email" style="text-decoration: none; text-align: center; display: block; background: #25d366; margin-bottom: 10px;">
            <span>RESPONDER PELO WHATSAPP</span>
        </a>

        <a href="" id="btn-responder" class="btn-whats-email" style="text-decoration: none; text-align: center; display: block; opacity: 0.8;">
            <span>RESPONDER POR E-MAIL</span>
        </a>
    </div>
</div>

<div id="modalHistoricoPropostas" class="modal" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); overflow-y: auto;">
    <div class="modal-content" style="max-width: 650px; background: #0a0a0a; border: 1px solid #00f2ff; margin: 50px auto; padding: 25px; border-radius: 12px; position: relative; box-shadow: 0 0 30px rgba(0, 242, 255, 0.15);">
        
        <span class="close" onclick="closeModal('modalHistoricoPropostas')" style="position: absolute; right: 20px; top: 15px; color: #666; font-size: 24px; cursor: pointer; transition: 0.3s;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#666'">&times;</span>
        
        <h2 style="font-family: 'Orbitron', sans-serif; color: #00f2ff; margin-bottom: 20px; font-size: 1.1rem; letter-spacing: 2px;">HIST√ìRICO DE PROPOSTAS</h2>
        
        <div style="position: relative; margin-bottom: 20px;">
            <input type="text" id="filtroProposta" onkeyup="filtrarPropostas()" placeholder="Filtrar por nome ou data..." 
                   style="width: 100%; padding: 12px 15px; background: rgba(255,255,255,0.03); border: 1px solid rgba(0,242,255,0.2); color: white; border-radius: 6px; outline: none; font-size: 0.9rem;">
        </div>

        <div style="max-height: 450px; overflow-y: auto; padding-right: 10px;" id="listaPropostasContainer">
            {% if historico_propostas %}
                {% for prop in historico_propostas %}
                <div class="item-proposta" style="padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; gap: 20px; transition: 0.3s;">
                    
                    <div style="flex: 1; min-width: 0;">
                        <strong style="color: #fff; display: block; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{{ prop.nome_festa }}">
                            {{ prop.nome_festa }}
                        </strong>
                        <div style="margin-top: 5px; display: flex; align-items: center; gap: 10px; font-size: 0.75rem;">
                            <span style="color: #00f2ff; opacity: 0.8;">{{ prop.data_festa }}</span>
                            <span style="width: 4px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 50%;"></span>
                            <span style="color: #00ff88; font-weight: 600;">R$ {{ prop.valor_cache }}</span>
                        </div>
                    </div>

                    <div style="flex-shrink: 0; display: flex; gap: 8px;">
                        <button onclick="editarProposta(`{{ prop.nome_festa }}`, `{{ prop.local_festa }}`, `{{ prop.data_festa }}`, `{{ prop.hora_festa }}`, `{{ prop.valor_cache }}`, `{{ prop.documento_artista }}`, `{{ prop.detalhes_show | replace('\n', ' ') | replace('\r', ' ') }}`, `{{ prop.auth_id }}`)" 
                                class="btn-card-action" 
                                style="padding: 8px 12px; font-size: 0.65rem; background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); min-width: auto; cursor: pointer;">
                            EDITAR
                        </button>

                        <button onclick="reimprimirProposta('{{ prop.auth_id }}')" 
                                class="btn-card-action" 
                                style="padding: 8px 16px; font-size: 0.65rem; font-weight: 700; background: #00f2ff; color: #000; min-width: 80px;">
                            ABRIR
                        </button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div style="text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.2);">
                    <p style="font-size: 0.9rem;">Nenhuma proposta encontrada no seu banco.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Fun√ß√£o para abrir a proposta salva
function reimprimirProposta(authId) {
    if(authId) {
        window.open('/gerar_proposta_reimpressao/' + authId, '_blank');
    }
}

// Fun√ß√£o de filtro ultra-r√°pida
function filtrarPropostas() {
    const input = document.getElementById('filtroProposta').value.toLowerCase();
    const itens = document.getElementsByClassName('item-proposta');
    
    Array.from(itens).forEach(item => {
        const texto = item.innerText.toLowerCase();
        item.style.display = texto.includes(input) ? "flex" : "none";
    });
}

function editarProposta(nome, local, data, hora, valor, documento, detalhes, tempId) {
    closeModal('modalHistoricoPropostas');
    const modal = document.getElementById('modalProposta');
    modal.style.display = 'flex';
    
    const form = modal.querySelector('form');
    const btnSubmit = document.getElementById('btn-submit-proposta');

    // Preenche os campos
    form.querySelector('input[name="nome_festa"]').value = nome || '';
    form.querySelector('input[name="local_festa"]').value = local || '';
    form.querySelector('input[name="hora_festa"]').value = hora || '';
    form.querySelector('input[name="valor_cache"]').value = valor || '';
    form.querySelector('input[name="documento_artista"]').value = documento || '';
    form.querySelector('textarea[name="detalhes_show"]').value = detalhes || '';
    
    if (tempId) {
        document.getElementById('proposta_temp_id').value = tempId;
    }

    // Troca o texto e aplica sua cor padr√£o #00f2ff
    btnSubmit.innerText = "SALVAR ALTERA√á√ïES";
    btnSubmit.style.background = "#00f2ff"; 
    btnSubmit.style.color = "#121212"; // Texto escuro para dar contraste no ciano
    btnSubmit.style.border = "none";
    btnSubmit.style.fontWeight = "bold";

    // NOVA TRAVA COM MODAL PERSONALIZADA
    form.onsubmit = function(e) {
        e.preventDefault(); // Bloqueia o envio autom√°tico para perguntar antes
        
        const modalConfirma = document.getElementById('modalConfirmacaoEdicao');
        modalConfirma.style.display = 'flex';

        // Op√ß√£o 1: SUBSTITUIR (Mant√©m o ID atual)
        document.getElementById('btnSubstituir').onclick = function() {
            modalConfirma.style.display = 'none';
            form.submit(); // Envia com o ID que j√° est√° l√° (sobrescreve)
        };

        // Op√ß√£o 2: GERAR NOVA (Troca o ID antes de enviar)
        document.getElementById('btnGerarCopia').onclick = function() {
            modalConfirma.style.display = 'none';
            // Gera um ID novo aleat√≥rio para o Python achar que √© uma nova proposta
            document.getElementById('proposta_temp_id').value = Math.floor(Math.random() * 999999);
            form.submit(); 
        };
    };

    if (data && data.includes('/')) {
        const partes = data.split('/');
        form.querySelector('input[name="data_festa"]').value = `${partes[2]}-${partes[1]}-${partes[0]}`;
    }
}
</script>
<div id="modalConfirmacaoEdicao" class="modal-overlay" style="display:none; z-index: 10001; background: rgba(0,0,0,0.9);">
    <div class="modal-content" style="max-width: 400px; text-align: center; border: 1px solid #00f2ff; background: #121212; padding: 30px; border-radius: 12px; box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);">
        <h3 style="color: #00f2ff; margin-top: 0; font-family: sans-serif;">‚ö†Ô∏è Aten√ß√£o na Edi√ß√£o</h3>
        <p style="color: #ffffff; font-size: 0.95rem; margin-bottom: 25px; line-height: 1.5; opacity: 0.9;">
            Voc√™ est√° editando uma proposta existente. O que deseja fazer?
        </p>
        
        <div style="display: flex; flex-direction: column; gap: 12px;">
            <button id="btnSubstituir" class="btn-full-premium" 
                style="background: #00f2ff; color: #000; font-weight: bold; border: none; padding: 14px; cursor: pointer; border-radius: 6px; text-transform: uppercase; transition: 0.3s;">
                Substituir Original
            </button>
            
            <button id="btnGerarCopia" 
                style="background: transparent; color: #00f2ff; border: 1px solid #00f2ff; padding: 14px; cursor: pointer; border-radius: 6px; text-transform: uppercase; font-size: 0.75rem; transition: 0.3s;">
                Gerar como Nova (Criar C√≥pia)
            </button>
            
            <button onclick="document.getElementById('modalConfirmacaoEdicao').style.display='none'" 
                style="background:none; border:none; color:#666; cursor:pointer; font-size:0.8rem; margin-top: 10px;">
                Voltar e continuar editando
            </button>
        </div>
    </div>
</div>

<!-- GERAR PROPOSTA - OR√áAMENTO -->
<div id="modalProposta" class="modal-overlay">
    <div class="modal-content-large">
        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
    <h2 style="color: #fff; font-size: 1.2rem; margin: 0;">Propostas</h2>
    <button onclick="closeModal('modalProposta')" style="background: none; border: none; color: #666; font-size: 1.8rem; cursor: pointer;">&times;</button>
</div>

<div class="container-historico-atalho mobile-only-shortcut" 
     onclick="closeModal('modalProposta'); setTimeout(() => { openModal('modalHistoricoPropostas'); }, 300);"
     style="position: relative; background: rgba(0, 242, 255, 0.05); border: 1px dashed rgba(0, 242, 255, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 25px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
    
    <div style="display: flex; align-items: center; gap: 12px;">
        <div style="position: relative;">
            <div style="background: #00f2ff; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #121212;">
                <i class="fas fa-list-ul"></i>
            </div>
            {% if total_propostas and total_propostas > 0 %}
                <span class="badge-atalho-mobile">{{ total_propostas }}</span>
            {% endif %}
        </div>

        <div>
            <span style="color: #00f2ff; display: block; font-weight: bold; font-size: 0.9rem;">MINHAS PROPOSTAS</span>
            <span style="color: #888; font-size: 0.7rem;">Ver, editar ou baixar propostas enviadas</span>
        </div>
    </div>
    <i class="fas fa-chevron-right" style="color: #444;"></i>
</div>

<div class="section-title" style="margin-top: 10px;">Criar Nova Proposta</div>

        <form action="{{ url_for('gerar_proposta') }}" method="POST" target="_blank">
            
            <input type="hidden" name="proposta_temp_id" id="proposta_temp_id" value="{{ range(1, 999999) | random }}">
            
            <div class="modal-body">
                <div class="section-title">A Festa / Evento</div>
                <div class="input-grid">
                    <div class="input-item">
                        <label>Nome da Festa</label>
                        <input type="text" name="nome_festa" placeholder="Ex: Casamento de Ana e Bruno" required>
                    </div>
                    <div class="input-item">
                        <label>Seu CPF ou CNPJ</label>
                        <input type="text" name="documento_artista" placeholder="Apenas n√∫meros">
                    </div>
                    <div class="input-item">
                        <label>Local do Evento</label>
                        <input type="text" name="local_festa" placeholder="Nome do Buffet ou Clube">
                    </div>
                </div>

                <div class="input-grid">
                    <div class="input-item">
                        <label>Dia do Evento</label>
                        <input type="date" name="data_festa" required>
                    </div>
                    <div class="input-item">
                        <label>Hora de In√≠cio</label>
                        <input type="time" name="hora_festa" value="21:00">
                    </div>
                    <div class="input-item"></div>
                </div>

                <div class="section-title">O Show e Valor</div>
                <div class="input-grid">
                    <div class="input-item full-row">
                        <label>Sobre o Show / Detalhes</label>
                        <textarea name="detalhes_show" placeholder="Descreva o repert√≥rio, dura√ß√£o e diferenciais do seu show..."></textarea>
                    </div>
                </div>

                <div class="input-grid">
                    <div class="input-item">
                        <label>Cach√™ Final (R$)</label>
                        <input type="text" name="valor_cache" id="moeda" placeholder="0.000,00" required>
                    </div>

                    <div class="input-item">
                        <label>Clima & Identidade Visual</label>
                        <div class="visual-selector-container">
                            <div class="mini-themes-row">
                                <label class="theme-chip">
                                    <input type="radio" name="estilo_pdf" value="vip" data-color="#f2a900">
                                    <div class="chip-inner">
                                        <span class="icon">ü•Ç</span>
                                        <span class="text">VIP</span>
                                    </div>
                                </label>
                                <label class="theme-chip">
                                    <input type="radio" name="estilo_pdf" value="pulse" data-color="#00f2ff" checked>
                                    <div class="chip-inner">
                                        <span class="icon">‚ö°</span>
                                        <span class="text">PULSA</span>
                                    </div>
                                </label>
                                <label class="theme-chip">
                                    <input type="radio" name="estilo_pdf" value="acoustic" data-color="#a67c52">
                                    <div class="chip-inner">
                                        <span class="icon">üé∏</span>
                                        <span class="text">ACOUS</span>
                                    </div>
                                </label>
                                <label class="theme-chip">
                                    <input type="radio" name="estilo_pdf" value="pop" data-color="#ff007a">
                                    <div class="chip-inner">
                                        <span class="icon">üé§</span>
                                        <span class="text">POP</span>
                                    </div>
                                </label>
                                <label class="theme-chip">
                                    <input type="radio" name="estilo_pdf" value="signature" data-color="#333333">
                                    <div class="chip-inner">
                                        <span class="icon">‚úíÔ∏è</span>
                                        <span class="text">SIGN</span>
                                    </div>
                                </label>
                            </div>

                            <div class="color-picker-box" id="preview-box">
                                <input type="color" name="cor_proposta" id="cor_proposta" value="#00f2ff">
                                <span id="label-cor">üé® COR</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="btn-footer-container">
                <button type="submit" id="btn-submit-proposta" class="btn-full-premium">
                    GERAR PROPOSTA COMERCIAL
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    window.NOME_DO_ARTISTA = "{{ musico.nome if musico else 'Artista' }}";
</script>
    
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>