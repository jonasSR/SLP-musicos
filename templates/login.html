<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Acesso Artista | Pulsa S√£o Luiz</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script type="module" src="{{ url_for('static', filename='js/auth.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
    
</head>

<body class="login-page-root">
    <div class="log-bg-mesh"></div>

    <div class="log-card-container">
        <a href="{{ url_for('index') }}" class="btn-back-home">
            <span>‚Üê</span> Voltar
        </a>

        <h1 class="log-glitch-title">Acesso ao <span>Painel</span></h1>
        <p class="log-subtitle">Gest√£o de Perfil | Pulsa Music Conect.</p>

        {% if confirmacao_venda %}
        <div id="welcome-msg" class="glass-card" style="border-left: 4px solid #00efff; margin-bottom: 25px; padding: 20px; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
            <h2 style="color: #00efff; font-family: 'Syne', sans-serif; font-size: 1.3rem; margin: 0;">Falta pouco para o seu show! üé∏</h2>
            <p style="color: #eee; font-size: 0.95rem; margin-top: 8px; line-height: 1.5;">
                Seja bem-vindo ao <strong>Pulsa S√£o Luiz</strong>. <br>
                Para liberar seu painel, basta criar sua senha de acesso abaixo usando o e-mail da sua inscri√ß√£o.
            </p>
        </div>
        {% endif %}

        <form id="auth-form" class="log-form-wrapper">
            <div class="log-field-group">
                <input type="email" id="email" class="log-input-field" required placeholder=" ">
                <label class="log-field-label">E-MAIL CORPORATIVO OU ART√çSTICO</label>
            </div>

            <div class="log-field-group log-pass-group">
                <input type="password" id="password" class="log-input-field" required minlength="7" placeholder=" ">
                <label class="log-field-label">SENHA (M√çN. 7 CARACTERES)</label>

                <button type="button" class="log-toggle-eye" aria-label="Mostrar senha">
                    üëÅ
                </button>
            </div>

            <button type="submit" id="btn-login" class="log-btn-main">
                CONECTAR
            </button>

            <button type="button" id="btn-signup" class="log-btn-main log-btn-outline">
                CRIAR CONTA
            </button>

            <div id="modal-auth" class="modal-overlay">
                <div class="modal-content glass-card">
                    <span class="close-modal" id="btn-close-x">&times;</span>
                    <h3 id="modal-title">Aten√ß√£o</h3>
                    <p id="modal-text">Preencha o usu√°rio e a senha e clique em criar conta.</p>
                    <button type="button" class="log-btn-main" id="btn-modal-confirm" style="width: 100%; margin-top: 15px;">ENTENDI</button>
                </div>
            </div>

            <button type="button" onclick="loginComGoogle()" class="google-btn-modern">
                <div class="google-icon-wrapper">
                    <img class="google-icon" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                </div>
                <span class="btn-text">ENTRAR COM GOOGLE</span>
            </button>

        </form>
    </div>

    <div id="modal-escolha-perfil" class="modal-overlay">
        <div class="modal-content glass-card">
            <h3>Como deseja entrar?</h3>
            <p>Selecione seu tipo de perfil para continuar:</p>
            
            <div class="opcoes-perfil">
                <button type="button" class="btn-perfil" id="btn-escolha-musico">
                    üé∏ SOU M√öSICO / BANDA
                </button>
                
                <button type="button" class="btn-perfil" id="btn-escolha-empresa">
                    üè¢ SOU ESTABELECIMENTO
                </button>
            </div>
        </div>
    </div>

    <div id="modal-retomar-cadastro" class="modal-overlay">
        <div class="modal-content glass-card">
            <h3 style="color: #ffcc00;">Cadastro em Aberto</h3>
            <p>Vimos que voc√™ parou seu cadastro como: <br>
            <strong id="tipo-pendente" style="color: #fff; font-size: 1.2em;"></strong>
            </p>
            <p style="font-size: 0.9em; color: #ccc;">Deseja continuar de onde parou?</p>
            
            <div class="opcoes-perfil">
                <button type="button" class="btn-perfil" id="btn-retomar-sim" style="background: #00ff88; color: #000;">
                    CONTINUAR CADASTRO
                </button>
                
                <button type="button" class="btn-perfil btn-perfil-cancelar" id="btn-retomar-nao">
                    ‚ùå EXCLUIR E RECOME√áAR
                </button>
            </div>
        </div>
    </div>

    
    <script>
        // Colocamos aspas para o editor achar que √© uma String comum
        // O | safe garante que o Flask n√£o quebre os caracteres
        const configData = '{{ firebase_config | tojson | safe }}';
        
        // Agora transformamos essa string em um objeto de verdade
        window.firebaseConfig = JSON.parse(configData);
        
        console.log("üî• Configura√ß√£o do Firebase injetada!");
    </script>
    <script type="module" src="{{ url_for('static', filename='js/auth.js') }}"></script>

    <script>
        // Converte o valor do Python para o JS com seguran√ßa
        const confirmacaoVenda = "{{ confirmacao_venda }}";

        if (confirmacaoVenda === 'True' || confirmacaoVenda === 'true') {
            // For√ßamos a execu√ß√£o assim que a janela carregar completamente
            window.onload = function() {
                const modal = document.getElementById('modal-auth');
                const modalTitle = document.getElementById('modal-title');
                const modalText = document.getElementById('modal-text');

                if (modal) {
                    // Atualiza o texto
                    modalTitle.innerText = "‚ú® Quase l√°!";
                    modalTitle.style.color = "#00efff";
                    modalText.innerHTML = "Sua conta j√° est√° ativa! <br> Defina sua senha abaixo e clique em <strong>CRIAR CONTA</strong> para acessar.";

                    // FOR√áA O APARECIMENTO (Sobrescreve qualquer CSS)
                    modal.style.setProperty('display', 'flex', 'important');
                    modal.style.setProperty('visibility', 'visible', 'important');
                    modal.style.setProperty('opacity', '1', 'important');
                    modal.classList.add('active');
                    
                    console.log("Modal for√ßada via Flask + JS");
                }
            };
        }
    </script>
</body>
</html>
