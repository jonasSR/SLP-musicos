<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ musico.nome }} | Pulsa Music Conect</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <meta property="og:title" content="Perfil de {{ musico.nome }}">
    <meta property="og:description" content="Confira o trabalho de {{ musico.nome }} no nosso portal.">
    <meta property="og:image" content="{{ musico.foto_url }}"> <meta property="og:type" content="profile">
</head>

<body class="profile-body">
    <div id="cursor-aura"></div>

    <main class="profile-split">
        <section class="artist-stage">
            <div class="artist-image-fixed" style="background-image: url('{{ musico.foto }}');">
                <div class="image-overlay"></div>
                <div class="artist-titles">
                    <h1 class="artist-main-name">{{ musico.nome }}</h1>
                </div>
            </div>
        </section>

        <section class="artist-details">
            <a href="/" class="btn-back-minimal">VOLTAR</a>

            <nav class="nav-links-container">
                <a href="#perfil" class="btn-nav-link" onclick="showMobileTab(event, 'perfil')">PERFIL</a>
                <a href="#reserve" class="btn-nav-link" onclick="showMobileTab(event, 'reserve')">CONTATO</a>
                <a href="#agenda" class="btn-nav-link" onclick="showMobileTab(event, 'agenda')">AGENDA</a>
                <a href="#mensagens" class="btn-nav-link" onclick="showMobileTab(event, 'mensagens')">COMUNIDADE</a>
                
                <a href="javascript:void(0)" 
                id="link-compartilhar"
                onclick="compartilharPerfil(this)" 
                data-nome-url="{{ musico.nome | replace(' ', '-') | lower }}" 
                data-nome-exibicao="{{ musico.nome }}"
                class="btn-nav-link">
                    <i class="fas fa-share-alt"></i> <span>COMPARTILHAR PERFIL</span>
                </a>
            </nav>

            <nav class="mobile-tabs">
                <button class="tab-btn active" onclick="showMobileTab(event, 'perfil')">
                    <i class="fas fa-user"></i> <span>Perfil</span>
                </button>
                <button class="tab-btn" onclick="showMobileTab(event, 'reserve')">
                    <i class="fas fa-calendar-alt"></i> <span>Reserve</span>
                </button>
                <button class="tab-btn" onclick="showMobileTab(event, 'agenda')">
                    <i class="fas fa-clock"></i> <span>Agenda</span>
                </button>
                <button class="tab-btn" onclick="showMobileTab(event, 'mensagens')">
                    <i class="fas fa-star"></i> <span>Seja f√£</span>
                </button>
            </nav>

            <div class="content-scroll-box">

                <div id="perfil" class="tab-content active">
                    <div class="stats-bar-modern">
                        <div class="stat-item" onclick="showMobileTab(event, 'mensagens')">
                            <div class="stat-icon"><i class="fas fa-users"></i></div>
                            <div class="stat-content">
                                <span class="stat-value">{{ qtd_fas }}</span>
                                <span class="stat-label">F√ÉS</span>
                            </div>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat-item">
                            <div class="stat-icon"><i class="fas fa-star"></i></div>
                            <div class="stat-content">
                                <span class="stat-value">{{ media_estrelas }}</span>
                                <span class="stat-label">AVALIA√á√ÉO</span>
                            </div>
                        </div>
                    </div>

                    <div class="social-container">
                        <h2 class="section-label">REDES SOCIAIS</h2>
                        <div class="artist-social-links">
                            {% if musico.instagram %}
                            <a href="https://instagram.com/{{ musico.instagram|replace('@', '') }}" target="_blank" class="social-icon-link" title="Instagram">
                                <i class="fab fa-instagram"></i>
                            </a>
                            {% endif %}
                            
                            {% if musico.facebook %}
                            <a href="{{ musico.facebook }}" target="_blank" class="social-icon-link" title="Facebook">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            {% endif %}
                            
                            {% if musico.youtube %}
                            <a href="{{ musico.youtube }}" target="_blank" class="social-icon-link" title="YouTube">
                                <i class="fab fa-youtube"></i>
                            </a>
                            {% endif %}
                            <a href="javascript:void(0)" 
                            onclick="compartilharPerfil(this)" 
                            data-nome-url="{{ musico.nome | replace(' ', '-') | lower }}" 
                            data-nome-exibicao="{{ musico.nome }}"
                            class="social-icon-link share-mobile-only" title="Compartilhar">
                                <i class="fas fa-share-alt"></i>
                            </a>
                        </div>
                    </div>

                    <hr class="section-divider">

                    <div class="player-wrapper">
                        <h2 class="section-label">VIBRA√á√ÉO</h2>
                        
                        {% if musico.vibracao_link %}
                            {# PLAYER LOCAL: Estilizado para ser minimalista #}
                            <div class="vibracao-local-card">
                                <iframe 
                                    src="{{ musico.vibracao_link.replace('open.spotify.com/track/', 'open.spotify.com/embed/track/') }}?utm_source=generator&theme=0" 
                                    width="100%" 
                                    height="80" 
                                    frameBorder="0" 
                                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                                    style="border-radius: 12px; filter: hue-rotate(180deg) brightness(0.9);">
                                </iframe>
                            </div>
                        {% else %}
                            {# ORIGINAL: Exatamente como voc√™ tem hoje #}
                            <div class="glass-player" style="opacity: 0.5;">
                                <div class="play-icon">‚ñ∂</div>
                                <div class="wave-animation">
                                    <span></span><span></span><span></span><span></span><span></span>
                                </div>
                                <p>PREVIEW EM BREVE</p>
                            </div>
                        {% endif %}
                    </div>

                    <hr class="section-divider">

                    <div class="info-group">
                        <h2 class="section-label">ESTILO</h2>
                        <span class="genre-badge">{{ musico.estilo }}</span>
                    </div>

                    <div class="bio-container">
                        <h2 class="section-label">DESCRI√á√ÉO</h2>
                        <div class="bio-text">
                            {{ musico.bio }}
                        </div>
                    </div>
                </div> <div id="reserve" class="tab-content">
                    <hr class="section-divider">
                    <div class="booking-glass-card">
                        <header class="card-header">
                            <h3>RESERVE A DATA</h3>
                            <p>Conecte este artista ao seu evento.</p>
                        </header>

                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                            <div id="flash-container">
                                {% for category, message in messages %}
                                <div class="alert-glass {{ category }}">
                                    <span class="icon">{% if category == 'success' %}‚ú®{% else %}‚ö†Ô∏è{% endif %}</span>
                                    {{ message }}
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        {% endwith %}

                        <form action="/reservar" method="POST" class="profile-form">
                            <input type="hidden" name="musico_id" value="{{ id }}">
                            
                            <div class="input-modern">
                                <label class="label-fixed">SEU NOME</label>
                                <input type="text" name="nome_solicitante" placeholder="Ex: Jo√£o Silva" required>
                            </div>
                            
                            <div class="input-modern">
                                <label class="label-fixed">E-MAIL DE CONTATO</label>
                                <input type="email" name="email_solicitante" placeholder="seu@email.com" required>
                            </div>
                            
                            <div class="input-modern">
                                <label class="label-fixed">WHATSAPP / TELEFONE</label>
                                <input type="tel" name="telefone_solicitante" placeholder="(12) 99999-9999" required>
                            </div>
                            
                            <div class="input-modern">
                                <label class="label-fixed">DATA DO EVENTO</label>
                                <input type="text" name="data_evento" id="data-criativa" placeholder="Selecione o dia..." required>
                            </div>
                            
                            <div class="input-modern">
                                <label class="label-fixed">LOCAL DO EVENTO</label>
                                <input type="text" name="local_evento" placeholder="Ex: Pousada do Sol ou Endere√ßo" required>
                            </div>

                            <div class="custom-select-container" id="tipoEventoContainer">
                                <label class="label-fixed">TIPO DE EVENTO</label>
                                <div class="select-trigger" onclick="toggleDropdown()">
                                    <span id="selected-text">Selecione o tipo...</span>
                                    <i class="arrow-icon">‚ñº</i>
                                </div>
                                <div class="select-options" id="optionsList">
                                    <div class="option-group">SOCIAIS</div>
                                    <div class="option-item" onclick="selectOption('Casamento', 'casamento')">Casamento</div>
                                    <div class="option-item" onclick="selectOption('Anivers√°rio', 'aniversario')">Anivers√°rio / Particular</div>
                                    
                                    <div class="option-group">P√öBLICOS E CULTURAIS</div>
                                    <div class="option-item" onclick="selectOption('Festival', 'festival')">Festival / Evento P√∫blico</div>
                                    <div class="option-item" onclick="selectOption('Carnaval', 'carnaval')">Carnaval / Bloco</div>
                                    
                                    <div class="option-group">COMERCIAIS</div>
                                    <div class="option-item" onclick="selectOption('Bar / Restaurante', 'bar')">Bar / Restaurante</div>
                                    
                                    <div class="option-group">DIVERSOS</div>
                                    <div class="option-item" onclick="selectOption('Outros', 'outro')">Outros</div>
                                </div>
                                <input type="hidden" name="tipo" id="tipo_hidden_input">
                            </div>

                            <button type="submit" class="btn-plasma full-width">SOLICITAR OR√áAMENTO</button>
                        </form>
                    </div>
                </div>

                <div id="agenda" class="tab-content">
                    <hr class="section-divider">
                    <div class="agenda-container">
                        <h2 class="section-label">AGENDA</h2>
                        <div class="agenda-list">
                            {% for show in agenda %}
                            <div class="agenda-item-card-public">
                                <div class="card-side-date">
                                    <span class="date-number">{{ show.data_dia }}</span>
                                    <span class="date-month">{{ show.data_mes }}</span>
                                </div>

                                <div class="card-main-content">
                                    {% if show.nome_festa %}
                                    <div class="show-title">{{ show.nome_festa | upper }}</div>
                                    {% endif %}
                                    
                                    <div class="show-details">
                                        <span>üìç {{ show.local }}</span>
                                        <div class="show-meta-row">
                                            <span>üèôÔ∏è {{ show.cidade }}</span>
                                            <span class="separator">‚Ä¢</span>
                                            <span>üïí {{ show.horario }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="empty-state">
                                <p>A agenda de shows est√° sendo atualizada.</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div id="mensagens" class="tab-content">
                    <hr class="section-divider">
                    <div class="glass-card feedback-form-card">
                        <h3>DEIXE SUA ESTRELA ‚ú®</h3>
                        <p>Conte para o artista o que achou da vibe!</p>
                        
                        <form id="form-feedback" class="feedback-grid">
                            <input type="hidden" name="artista_id" value="{{ id }}">
                            <input type="hidden" name="artista_email" value="{{ musico.dono_email }}">
                            
                            <div class="rating-selection">
                                <input type="radio" name="estrelas" value="5" id="star5" checked><label for="star5">‚òÖ</label>
                                <input type="radio" name="estrelas" value="4" id="star4"><label for="star4">‚òÖ</label>
                                <input type="radio" name="estrelas" value="3" id="star3"><label for="star3">‚òÖ</label>
                                <input type="radio" name="estrelas" value="2" id="star2"><label for="star2">‚òÖ</label>
                                <input type="radio" name="estrelas" value="1" id="star1"><label for="star1">‚òÖ</label>
                            </div>

                            <div class="input-nome">
                                <input type="text" name="nome_fa" placeholder="Seu nome ou apelido" required>
                            </div>

                            <div class="input-comentario">
                                <textarea name="comentario" placeholder="Escreva um depoimento..." rows="3" required></textarea>
                            </div>

                            <button type="submit" class="btn-mural" id="btn-enviar-feedback">ENVIAR NO MURAL</button>
                        </form>
                    </div>

                    <hr class="section-divider">    

                    <div class="mural-container">
                        <div class="mural-header">
                            <h2 class="mural-title">COMUNIDADE</h2>
                            <span class="mural-subtitle">{{ feedbacks|length }} VIBRA√á√ïES ENCONTRADAS</span>
                        </div>

                        <div class="mural-scroll">
                            {% for feedback in feedbacks %}
                            <div class="vibe-card">
                                <div class="vibe-header">
                                    <div class="vibe-avatar">
                                        {{ feedback.nome_fa[0]|upper }}
                                    </div>
                                    <div class="vibe-user-info">
                                        <span class="vibe-user">
                                            <i class="fas fa-user-bolt" style="font-size: 0.65rem; margin-right: 4px; color: var(--accent);"></i>
                                            @{{ feedback.nome_fa|replace(' ', '')|upper }}
                                        </span>
                                        <div class="vibe-rating">
                                            {% for i in range(feedback.estrelas|int) %}
                                            <i class="fas fa-star"></i>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>

                                <div class="vibe-content">
                                    <p class="vibe-text">{{ feedback.comentario }}</p>
                                </div>
                            </div>
                            {% else %}
                            <div class="empty-mural">
                                <i class="fas fa-compact-disc fa-spin"></i>
                                <p>Aguardando as primeiras vibra√ß√µes da comunidade...</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div> 
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    <script src="{{ url_for('static', filename='js/perfil.js') }}"></script>
</body>
</html>