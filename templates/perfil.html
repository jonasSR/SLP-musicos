<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ musico.nome }} | Pulsa S√£o Luiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    
</head>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<body class="profile-body">
    <div id="cursor-aura"></div>

    <main class="profile-split">
        <section class="artist-stage">
            <div class="artist-image-fixed" style="background-image: url('{{ musico.foto }}');">
                <div class="image-overlay"></div>
                
                <div class="artist-titles">
                    <h1 class="artist-main-name">{{ musico.nome }}</h1>
                </div>
            </div>
        </section>

        <section class="artist-details">
            <a href="/" class="btn-back-minimal">‚Üê VOLTAR</a>

            <div class="content-scroll-box">
                <div class="info-group">
                    <h2 class="section-label">ESTILO</h2>
                    <span class="genre-badge">{{ musico.estilo }}</span>
                </div>

                <div class="bio-container">
                    <h2 class="section-label">DESCRI√á√ÉO</h2>
                    <div class="bio-text">
                        {{ musico.bio }}
                    </div>
                </div>

                <div class="player-wrapper">
                    <h2 class="section-label">VIBRA√á√ÉO</h2>
                    <div class="glass-player">
                        <div class="play-icon">‚ñ∂</div>
                        <div class="wave-animation">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                        <p>PREVIEW SONORO DISPON√çVEL</p>
                    </div>
                </div>

                <div class="booking-glass-card">
                    <div class="card-header">
                        <h3>RESERVE A DATA</h3>
                        <p>Conecte este artista ao seu evento.</p>
                    </div>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                        <div id="flash-container">
                            {% for category, message in messages %}
                            <div class="alert-glass {{ category }}">
                                <span class="icon">{% if category == 'success' %}‚ú®{% else %}‚ö†Ô∏è{% endif %}</span>
                                {{ message }}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    {% endwith %}

                    <form action="/reservar" method="POST" class="profile-form">
                        <input type="hidden" name="musico_id" value="{{ id }}">
                        
                        <div class="input-modern">
                            <label class="label-fixed">SEU NOME</label>
                            <input type="text" name="nome_solicitante" placeholder="Ex: Jo√£o Silva" required>
                        </div>

                        <div class="input-modern">
                            <label class="label-fixed">E-MAIL DE CONTATO</label>
                            <input type="email" name="email_solicitante" placeholder="seu@email.com" required>
                        </div>

                        <div class="input-modern">
                            <label class="label-fixed">WHATSAPP / TELEFONE</label>
                            <input type="tel" name="telefone_solicitante" placeholder="(12) 99999-9999" required>
                        </div>

                        <div class="input-modern">
                            <label class="label-fixed">DATA DO EVENTO</label>
                            <input type="text" name="data_evento" id="data-criativa" placeholder="Selecione o dia..." required>
                        </div>

                        <div class="input-modern">
                            <label class="label-fixed">LOCAL DO EVENTO</label>
                            <input type="text" name="local_evento" placeholder="Ex: Pousada do Sol ou Endere√ßo" required>
                        </div>

                        <div class="custom-select-container" id="tipoEventoContainer">
                            <label class="label-fixed">TIPO DE EVENTO</label>
                            
                            <div class="select-trigger" onclick="toggleDropdown()">
                                <span id="selected-text">Selecione o tipo...</span>
                                <i class="arrow-icon">‚ñº</i>
                            </div>

                            <div class="select-options" id="optionsList">
                                <div class="option-group">SOCIAIS</div>
                                <div class="option-item" onclick="selectOption('Casamento', 'casamento')">Casamento</div>
                                <div class="option-item" onclick="selectOption('Anivers√°rio', 'aniversario')">Anivers√°rio / Particular</div>
                                
                                <div class="option-group">P√öBLICOS E CULTURAIS</div>
                                <div class="option-item" onclick="selectOption('Festival', 'festival')">Festival / Evento P√∫blico</div>
                                <div class="option-item" onclick="selectOption('Carnaval', 'carnaval')">Carnaval / Bloco</div>

                                <div class="option-group">COMERCIAIS</div>
                                <div class="option-item" onclick="selectOption('Bar / Restaurante', 'bar')">Bar / Restaurante</div>

                                <div class="option-group">DIVERSOS</div>
                                <div class="option-item" onclick="selectOption('Outros', 'outro')">Outros</div>
                            </div>

                            <input type="hidden" name="tipo" id="tipo_hidden_input">
                        </div>

                        <button type="submit" class="btn-plasma" style="width: 100%; margin-top: 20px;">SOLICITAR OR√áAMENTO</button>
                    </form>
                    </form>
                </div>

                <div class="agenda-container">
                    <h2 class="section-label">LINHA DO TEMPO</h2>
                    <div class="agenda-list">
                        {% for show in agenda %}
                        <div class="agenda-item">
                            <div class="agenda-date-box">
                                <span class="day">{{ show.data_dia }}</span>
                                <span class="month">{{ show.data_mes }}</span>
                            </div>
                            <div class="agenda-info">
                                {% if show.nome_festa %}
                                    <strong style="color: var(--primary); display: block; font-size: 0.8rem;">{{ show.nome_festa | upper }}</strong>
                                {% endif %}
                                
                                <span class="venue-name">{{ show.local }}</span>
                                
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <span class="city-tag">{{ show.cidade }}</span>
                                    <span style="font-size: 0.75rem; color: #888;">üïí {{ show.horario }}</span>
                                </div>
                            </div>
                            <div class="agenda-status">
                                <div class="pulse-dot"></div>
                                CONFIRMADO
                            </div>
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <p>A agenda de shows est√° sendo atualizada.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>

        <script>
            flatpickr("#data-criativa", {
                "locale": "pt", 
                dateFormat: "d/m/Y",
                disableMobile: "true", 
                minDate: "today", 
                onReady: function(selectedDates, dateStr, instance) {
                    instance.calendarContainer.classList.add("custom-flatpickr");
                }, // <--- Faltava essa v√≠rgula e o fechamento da chave
                onOpen: function(selectedDates, dateStr, instance) {
                    instance.calendarContainer.classList.add("open");
                }
            });
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const flashContainer = document.getElementById('flash-container');
                if (flashContainer) {
                    setTimeout(() => {
                        flashContainer.style.transition = "opacity 0.8s ease";
                        flashContainer.style.opacity = "0";
                        setTimeout(() => flashContainer.remove(), 800);
                    }, 5000); // 5 segundos
                }
            });
        </script>

        <script>
            document.querySelector('.profile-form').addEventListener('submit', async (e) => {
                e.preventDefault(); // Impede o navegador de abrir a p√°gina de JSON puro

                const formData = new FormData(e.target);
                const submitBtn = e.target.querySelector('button');
                
                // Desativa o bot√£o para evitar cliques duplos
                submitBtn.disabled = true;
                submitBtn.innerText = "ENVIANDO...";

                try {
                    const response = await fetch('/reservar', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.status === 'success') {
                        Swal.fire({
                            title: 'Sucesso!',
                            text: result.message,
                            icon: 'success',
                            background: '#1a1a1a', // Cor escura para combinar com seu tema
                            color: '#fff',
                            confirmButtonColor: '#6200ea',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            // Redireciona de volta para o perfil do m√∫sico
                            window.location.href = result.redirect;
                        });
                    } else {
                        Swal.fire({
                            title: 'Erro',
                            text: result.message,
                            icon: 'error',
                            background: '#1a1a1a',
                            color: '#fff'
                        });
                        submitBtn.disabled = false;
                        submitBtn.innerText = "SOLICITAR OR√áAMENTO";
                    }
                } catch (error) {
                    console.error('Erro:', error);
                    Swal.fire('Erro', 'Ocorreu uma falha na conex√£o.', 'error');
                    submitBtn.disabled = false;
                    submitBtn.innerText = "SOLICITAR OR√áAMENTO";
                }
            });

            function toggleDropdown() {
                document.getElementById('optionsList').classList.toggle('active');
            }

            function selectOption(texto, valor) {
                // Atualiza o texto que o usu√°rio v√™
                document.getElementById('selected-text').innerText = texto;
                document.getElementById('selected-text').style.color = "#00d2ff";
                
                // Salva o valor no input escondido para o Flask receber
                document.getElementById('tipo_hidden_input').value = valor;
                
                // Fecha o menu
                toggleDropdown();
            }

            // Fecha o menu se clicar fora dele
            window.onclick = function(event) {
                if (!event.target.matches('.select-trigger') && !event.target.matches('#selected-text')) {
                    const dropdown = document.getElementById('optionsList');
                    if (dropdown.classList.contains('active')) {
                        dropdown.classList.remove('active');
                    }
                }
            }
        </script>
    </body>
</html>